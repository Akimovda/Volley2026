# Profile — Volley

## 1. Цель профиля
Профиль пользователя в Volley — это:
- контактные данные
- данные игрока (уровни, амплуа/зоны)
- данные для допуска к мероприятиям

Принцип: **профиль проверяется не при логине**, а при попытке записаться на мероприятие.

---

## 2. Поля пользователя (users)

### Базовые
- `first_name` — имя
- `last_name` — фамилия
- `phone` — телефон (верификация планируется)
- `email` — служебный/реальный email (может быть fake для соцлогинов)

### Идентификация
- `telegram_id`, `telegram_username`
- `vk_id`, `vk_email`

### Игровые данные
- `birth_date` — дата рождения (нужна для правила <18/≥18)
- `classic_level` — уровень классики (число)
- `beach_level` — уровень пляжа (число)
- `beach_universal` — универсал (пляж), boolean

---

## 3. Справочник уровней

### 3.1 Хранение
В базе уровни хранятся как числа. В UI показываются **только названия**.

Рекомендуемая шкала (18+):
1 — Начальный  
2 — Начальный+  
3 — Средний-  
4 — Средний  
5 — Средний+  
6 — Полупрофи (КМС)  
7 — Профи (МС)

### 3.2 Правило для несовершеннолетних (<18)
Разрешено только 3 уровня:
- 1 — Начальный
- 2 — Начальный+
- 4 — Средний

Цель: ограничить “самоопределение” подростков и не давать высокие уровни.

---

## 4. Выбор уровня: только 1 раз
Игрок выбирает уровень самостоятельно **один раз**.

Далее уровень может изменить только:
- админ
- организатор
- помощник организатора

Технически:
- применяется Gate `edit-player-levels`
- если уровень уже установлен и Gate запрещает — изменения игнорируются/не принимаются

---

## 5. Амплуа (классика)

### 5.1 Требования
- игрок может выбрать **несколько** амплуа
- среди выбранных указывает **основное** (одно)

Список амплуа:
- Связующий
- Доигровщик
- Диагональный
- Центральный блокирующий
- Либеро

### 5.2 Хранение (таблица)
`user_classic_positions`:
- `user_id`
- `position` (ключ, например setter/outside/opposite/middle/libero)
- `is_primary` (одно основное)

---

## 6. Зоны (пляж)

### 6.1 Требования
- игрок выбирает зоны 2 и/или 4
- указывает основную зону (если не универсал)
- либо отмечает “универсал”:
  - зоны не выбираются
  - в UI показывается подсказка “игрок хорошо играет в любой зоне на своём уровне”

### 6.2 Хранение
`users.beach_universal` boolean

`user_beach_zones`:
- `user_id`
- `zone` (2 или 4)
- `is_primary` (основная зона)

---

## 7. UI: страница определений уровней
Планируется страница `/levels`, где описаны определения уровней для самоопределения.

На странице профиля под выбором уровня — ссылка “посмотреть определения уровней”.

---

## 8. Интеграция с записью на мероприятие
При попытке записи:
- система вычисляет missing fields (по требованиям мероприятия)
- если missing есть → редирект `/profile/complete?required=...&event_id=...`
- после заполнения анкеты:
  - при отсутствии missing → выполняется автозапись
  - показывается приветственное сообщение
