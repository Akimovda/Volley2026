# Architecture — Volley

## 1. Общий обзор

Volley — это веб-приложение для организации волейбольных мероприятий
с акцентом на:
- удобный UX
- минимальные барьеры входа
- контекстную проверку данных пользователя

Архитектура строится по принципу:
> **Аутентификация ≠ Бизнес-логика**

---

## 2. Технологический стек

- Backend: Laravel 12
- Auth: Jetstream + Fortify
- DB: PostgreSQL
- Frontend: Blade + Vite
- Styles: Tailwind (база) + project CSS (`volley.css`)
- Auth providers:
  - Telegram (primary)
  - VK ID (secondary)

---

## 3. Основные домены

### Пользователь (User)
- идентификация
- профиль
- анкета игрока
- способы входа

### Мероприятие (Event)
- требования к участникам
- запись / отмена записи
- статус участия

---

## 4. Слои приложения

### 4.1 Контроллеры
Контроллеры **тонкие** и не содержат бизнес-логики.

Примеры:
- `EventRegistrationController`
- `ProfileExtraController`
- `EventsController`

Задача:
- принять запрос
- вызвать сервис
- вернуть redirect / response

---

### 4.2 Сервисы (Business Logic)

Вся логика требований вынесена в сервисы.

Пример:
App\Services\EventRegistrationRequirements

Сервисы:
- не знают о HTTP
- не знают о UI
- работают с моделями

---

### 4.3 Модели

Eloquent используется как ORM и слой доступа к данным.

Ключевые модели:
- `User`
- `Event`

Pivot-таблицы:
- `event_registrations`

---

## 5. UX-паттерны

### 5.1 Проверка по действию
- ❌ не при логине
- ❌ не при регистрации
- ✅ при попытке действия (запись на мероприятие)

---

### 5.2 Pending-состояния
Контекст пользователя хранится в `session`:

- `pending_event_join`
- `pending_profile_required`

Это позволяет:
- возвращать пользователя в поток
- не засорять URL
- избегать сложных FSM

---

## 6. Расширяемость

Архитектура допускает:
- добавление команд
- лимиты участников
- роли (организатор / игрок)
- платные мероприятия

Без изменения базовых принципов.

---

## 7. Ключевые принципы

- Контроллеры тонкие
- Логика в сервисах
- UX важнее формальной строгости
- Минимум блокировок
- Один пользователь — один аккаунт

